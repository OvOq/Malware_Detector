import numpy, scipy, os, array
import imageio
import matplotlib.pyplot as plt

# 一些参数
filename = 'E:/0/test1.dmp'
graphname = 'E:/0/test1.png'
threshold = 4 * 1048576 # 文件长度以4MB为阈值

# 读文件信息
f = open(filename, 'rb')
len = os.path.getsize(filename)

print('文件大小: %d B' % len)

# w的选择: 文件大于4MB,w=4096, 否则2048
if len > threshold:
    wid = 4096
else:
    wid = 2048

high = int(len / wid) # 一维数组数
rem = len%wid         # 剩余的字节

if high==0:
    high = 1

print('数组长: %d, 宽: %d.' % (high, wid))

# 将数据存为二维数组
a = array.array("B") # uint8
a.fromfile(f, len-rem)
f.close()

g = numpy.reshape(a, (high, wid))
g = numpy.uint8(g)

# 保存图片
# scipy.misc.imsave(graphname, g)
imageio.imsave(graphname, g)